{"version":3,"file":"IteratorContainer-legacy-Aw16tKw1.js","sources":["../../../../../node_modules/.pnpm/@tmagic+vue-iterator-container@0.2.2_@tmagic+core@1.6.0_typescript@5.9.2__@tmagic+vue-r_55bb8bd30aceb1cc9729fa86d752a135/node_modules/@tmagic/vue-iterator-container/src/IteratorItem.vue","../../../../../node_modules/.pnpm/@tmagic+vue-iterator-container@0.2.2_@tmagic+core@1.6.0_typescript@5.9.2__@tmagic+vue-r_55bb8bd30aceb1cc9729fa86d752a135/node_modules/@tmagic/vue-iterator-container/src/IteratorContainer.vue"],"sourcesContent":["<template>\n  <component\n    :is=\"containerComponent\"\n    :style=\"style\"\n    :class=\"className\"\n    :config=\"config\"\n    :iterator-index=\"iteratorIndex\"\n    :iterator-container-id=\"iteratorContainerId\"\n    :page-fragment-container-id=\"pageFragmentContainerId\"\n  ></component>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, inject, type PropType } from 'vue-demi';\n\nimport type TMagicApp from '@tmagic/core';\nimport { type Id } from '@tmagic/core';\nimport { useComponent, useComponentStatus } from '@tmagic/vue-runtime-help';\n\nimport { IteratorItemSchema } from './type';\n\nexport default defineComponent({\n  name: 'tmagic-iterator-container-item',\n\n  props: {\n    config: {\n      type: Object as PropType<IteratorItemSchema>,\n      required: true,\n    },\n    iteratorIndex: Array as PropType<number[]>,\n    iteratorContainerId: Array as PropType<Id[]>,\n    containerIndex: Number,\n    pageFragmentContainerId: [String, Number] as PropType<Id>,\n    index: Number,\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n\n  setup(props) {\n    const app = inject<TMagicApp>('app');\n\n    const containerComponent = useComponent({ componentType: 'container', app });\n\n    const { style, className } = useComponentStatus(props);\n\n    return {\n      style,\n      className,\n      containerComponent,\n    };\n  },\n});\n</script>\n","<template>\n  <div @click=\"clickHandler\">\n    <IteratorItem\n      v-for=\"(item, index) in configs\"\n      :key=\"index\"\n      :config=\"item\"\n      :iterator-index=\"[...(iteratorIndex || []), index]\"\n      :iterator-container-id=\"\n        config.id ? [...(iteratorContainerId || []), config.id] : [...(iteratorContainerId || [])]\n      \"\n      :page-fragment-container-id=\"pageFragmentContainerId\"\n    ></IteratorItem>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, type PropType, watch } from 'vue-demi';\n\nimport {\n  COMMON_EVENT_PREFIX,\n  DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX,\n  type Id,\n  type IteratorContainer as TMagicIteratorContainer,\n  type MIteratorContainer,\n  type MNode,\n} from '@tmagic/core';\nimport { registerNodeHooks, useApp } from '@tmagic/vue-runtime-help';\n\nimport IteratorItem from './IteratorItem.vue';\n\ninterface IteratorContainerSchema extends Omit<MIteratorContainer, 'id'> {\n  id?: Id;\n  type?: 'iterator-container';\n}\n\ninterface IteratorItemSchema {\n  items: MNode[];\n  condResult: boolean;\n  style: {\n    [key: string]: any;\n  };\n}\n\nexport default defineComponent({\n  name: 'tmagic-iterator-container',\n\n  components: { IteratorItem },\n\n  props: {\n    config: {\n      type: Object as PropType<IteratorContainerSchema>,\n      required: true,\n    },\n    iteratorIndex: Array as PropType<number[]>,\n    iteratorContainerId: Array as PropType<Id[]>,\n    containerIndex: Number,\n    pageFragmentContainerId: [String, Number] as PropType<Id>,\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n\n  setup(props) {\n    const { app, node } = useApp(props);\n    registerNodeHooks(node);\n\n    const configs = computed<IteratorItemSchema[]>(() => {\n      let { iteratorData = [] } = props.config;\n      const { itemConfig, dsField, items } = props.config;\n\n      if (\n        !Array.isArray(iteratorData) ||\n        (typeof iteratorData[0] === 'string' && iteratorData[0].startsWith(DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX))\n      ) {\n        iteratorData = [];\n      }\n\n      if (app?.platform === 'editor' && !iteratorData.length) {\n        iteratorData.push({});\n      }\n\n      return iteratorData.map((itemData: any) => {\n        const condResult =\n          app?.platform !== 'editor'\n            ? (app?.dataSourceManager?.compliedIteratorItemConds(itemData, itemConfig, dsField) ?? true)\n            : true;\n\n        const newItems = app?.dataSourceManager?.compliedIteratorItems(itemData, items, dsField) ?? items;\n\n        return {\n          items: newItems,\n          condResult,\n          style: {\n            position: 'relative',\n            left: 0,\n            top: 0,\n            ...itemConfig.style,\n          },\n        };\n      });\n    });\n\n    watch(\n      configs,\n      (configs) => {\n        if (!props.config.id) {\n          return;\n        }\n\n        const iteratorContainerNode = app?.getNode<TMagicIteratorContainer>(props.config.id, {\n          iteratorContainerId: props.iteratorContainerId,\n          iteratorIndex: props.iteratorIndex,\n          pageFragmentContainerId: props.pageFragmentContainerId,\n        });\n\n        if (!iteratorContainerNode) {\n          return;\n        }\n\n        iteratorContainerNode.resetNodes();\n\n        configs.forEach((config, index) => {\n          iteratorContainerNode.setNodes(config.items, index);\n        });\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    const clickHandler = () => {\n      if (app && node) {\n        app.emit(`${COMMON_EVENT_PREFIX}click`, node);\n      }\n    };\n\n    return {\n      configs,\n      clickHandler,\n    };\n  },\n});\n</script>\n"],"names":["_sfc_main$1","defineComponent","name","props","config","type","Object","required","iteratorIndex","Array","iteratorContainerId","containerIndex","Number","pageFragmentContainerId","String","index","model","default","setup","app","inject","containerComponent","useComponent","componentType","style","className","useComponentStatus","_sfc_main","components","IteratorItem","_openBlock","_createBlock","_resolveDynamicComponent","_ctx","_normalizeStyle","class","_normalizeClass","node","useApp","registerNodeHooks","configs","computed","iteratorData","itemConfig","dsField","items","isArray","startsWith","DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX","platform","length","push","map","itemData","condResult","dataSourceManager","compliedIteratorItemConds","compliedIteratorItems","position","left","top","watch","id","iteratorContainerNode","getNode","resetNodes","forEach","setNodes","immediate","clickHandler","emit","COMMON_EVENT_PREFIX","_createElementBlock","onClick","_cache","args","_Fragment","_renderList","item","_component_IteratorItem","key"],"mappings":"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","x_google_ignoreList":[0,1]}