{"version":3,"file":"IteratorContainer-legacy-Nd531-AH.js","sources":["../../../../../node_modules/.pnpm/@tmagic+vue-iterator-container@1.0.0_@tmagic+core@1.7.6_typescript@5.9.3__@tmagic+vue-r_19de3c0d9e5e186b11c32b741f842344/node_modules/@tmagic/vue-iterator-container/src/IteratorItem.vue","../../../../../node_modules/.pnpm/@tmagic+vue-iterator-container@1.0.0_@tmagic+core@1.7.6_typescript@5.9.3__@tmagic+vue-r_19de3c0d9e5e186b11c32b741f842344/node_modules/@tmagic/vue-iterator-container/src/IteratorContainer.vue"],"sourcesContent":["<template>\n  <component\n    :is=\"containerComponent\"\n    :style=\"style\"\n    :class=\"className\"\n    :config=\"config\"\n    :iterator-index=\"iteratorIndex\"\n    :iterator-container-id=\"iteratorContainerId\"\n    :page-fragment-container-id=\"pageFragmentContainerId\"\n  ></component>\n</template>\n\n<script lang=\"ts\" setup>\nimport { inject } from 'vue';\n\nimport type TMagicApp from '@tmagic/core';\nimport { type Id } from '@tmagic/core';\nimport { useComponent, useComponentStatus } from '@tmagic/vue-runtime-help';\n\nimport { IteratorItemSchema } from './type';\n\ninterface IteratorItemProps {\n  config: IteratorItemSchema;\n  iteratorIndex?: number[];\n  iteratorContainerId?: Id[];\n  containerIndex?: number;\n  pageFragmentContainerId?: Id;\n  index?: number;\n  model?: Record<string, any>;\n}\n\ndefineOptions({\n  name: 'tmagic-iterator-container-item',\n});\n\nconst props = defineProps<IteratorItemProps>();\n\nconst app = inject<TMagicApp>('app');\n\nconst containerComponent = useComponent({ componentType: 'container', app });\n\nconst { style, className } = useComponentStatus(props);\n</script>\n","<template>\n  <div @click=\"clickHandler\">\n    <IteratorItem\n      v-for=\"(item, index) in configs\"\n      :key=\"index\"\n      :config=\"item\"\n      :iterator-index=\"[...(iteratorIndex || []), index]\"\n      :iterator-container-id=\"\n        config.id ? [...(iteratorContainerId || []), config.id] : [...(iteratorContainerId || [])]\n      \"\n      :page-fragment-container-id=\"pageFragmentContainerId\"\n    ></IteratorItem>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, watch } from 'vue';\n\nimport {\n  COMMON_EVENT_PREFIX,\n  type Id,\n  type IteratorContainer as TMagicIteratorContainer,\n  type MIteratorContainer,\n  type MNode,\n} from '@tmagic/core';\nimport { type ComponentProps, registerNodeHooks, useApp } from '@tmagic/vue-runtime-help';\n\nimport IteratorItem from './IteratorItem.vue';\n\ninterface IteratorContainerSchema extends Omit<MIteratorContainer, 'id'> {\n  id?: Id;\n  type?: 'iterator-container';\n}\n\ninterface IteratorItemSchema {\n  items: MNode[];\n  condResult: boolean;\n  style: {\n    [key: string]: any;\n  };\n}\n\ndefineOptions({\n  name: 'tmagic-iterator-container',\n});\n\nconst props = defineProps<ComponentProps<IteratorContainerSchema>>();\n\nconst { app, node } = useApp(props);\nregisterNodeHooks(node);\n\nconst configs = computed<IteratorItemSchema[]>(() => {\n  let { iteratorData = [] } = props.config;\n  const { itemConfig, dsField, items } = props.config;\n\n  if (!Array.isArray(iteratorData)) {\n    iteratorData = [];\n  }\n\n  if (app?.platform === 'editor' && !iteratorData.length) {\n    iteratorData.push({});\n  }\n\n  return iteratorData.map((itemData: any) => {\n    const condResult =\n      app?.platform !== 'editor'\n        ? (app?.dataSourceManager?.compliedIteratorItemConds(itemData, itemConfig, dsField) ?? true)\n        : true;\n\n    const newItems = app?.dataSourceManager?.compliedIteratorItems(itemData, items, dsField) ?? items;\n\n    return {\n      items: newItems,\n      condResult,\n      style: {\n        position: 'relative',\n        left: 0,\n        top: 0,\n        ...itemConfig.style,\n      },\n    };\n  });\n});\n\nwatch(\n  configs,\n  (configs) => {\n    if (!props.config.id) {\n      return;\n    }\n\n    const iteratorContainerNode = app?.getNode<TMagicIteratorContainer>(props.config.id, {\n      iteratorContainerId: props.iteratorContainerId,\n      iteratorIndex: props.iteratorIndex,\n      pageFragmentContainerId: props.pageFragmentContainerId,\n    });\n\n    if (!iteratorContainerNode) {\n      return;\n    }\n\n    iteratorContainerNode.resetNodes();\n\n    configs.forEach((config, index) => {\n      iteratorContainerNode.setNodes(config.items, index);\n    });\n  },\n  {\n    immediate: true,\n  },\n);\n\nconst clickHandler = () => {\n  if (app && node) {\n    app.emit(`${COMMON_EVENT_PREFIX}click`, node);\n  }\n};\n</script>\n"],"names":["props","__props","app","inject","containerComponent","useComponent","componentType","style","className","useComponentStatus","_openBlock","_createBlock","_resolveDynamicComponent","_unref","class","config","iteratorIndex","iteratorContainerId","pageFragmentContainerId","node","useApp","registerNodeHooks","configs","computed","iteratorData","itemConfig","dsField","items","Array","isArray","platform","length","push","map","itemData","condResult","dataSourceManager","compliedIteratorItemConds","compliedIteratorItems","position","left","top","watch","id","iteratorContainerNode","getNode","resetNodes","forEach","index","setNodes","immediate","clickHandler","emit","COMMON_EVENT_PREFIX","_createElementBlock","onClick","_Fragment","_renderList","value","item","IteratorItem","key"],"mappings":"qiBAmCA,MAAMA,EAAQC,EAERC,EAAMC,EAAkB,OAExBC,EAAqBC,EAAa,CAAEC,cAAe,YAAaJ,SAEhEK,MAAEA,EAAAC,UAAOA,GAAcC,EAAmBT,iBAxC9CU,IAAAC,EAQaC,EAPNC,EAAAT,IAAkB,CACtBG,QAAOM,EAAAN,IACPO,QAAOD,EAAAL,IACPO,OAAQd,EAAAc,OACR,iBAAgBd,EAAAe,cAChB,wBAAuBf,EAAAgB,oBACvB,6BAA4BhB,EAAAiB,kWCsCjC,MAAMlB,EAAQC,GAERC,IAAEA,EAAAiB,KAAKA,GAASC,EAAOpB,GAC7BqB,EAAkBF,GAElB,MAAMG,EAAUC,EAA+B,KAC7C,IAAIC,aAAEA,EAAe,IAAOxB,EAAMe,OAClC,MAAMU,WAAEA,EAAAC,QAAYA,EAAAC,MAASA,GAAU3B,EAAMe,OAU7C,OARKa,MAAMC,QAAQL,KACjBA,EAAe,IAGK,WAAlBtB,GAAK4B,UAA0BN,EAAaO,QAC9CP,EAAaQ,KAAK,IAGbR,EAAaS,IAAKC,IACvB,MAAMC,EACc,WAAlBjC,GAAK4B,WACA5B,GAAKkC,mBAAmBC,0BAA0BH,EAAUT,EAAYC,KAAY,GAK3F,MAAO,CACLC,MAHezB,GAAKkC,mBAAmBE,sBAAsBJ,EAAUP,EAAOD,IAAYC,EAI1FQ,aACA5B,MAAO,CACLgC,SAAU,WACVC,KAAM,EACNC,IAAK,KACFhB,EAAWlB,YAMtBmC,EACEpB,EACCA,IACC,IAAKtB,EAAMe,OAAO4B,GAChB,OAGF,MAAMC,EAAwB1C,GAAK2C,QAAiC7C,EAAMe,OAAO4B,GAAI,CACnF1B,oBAAqBjB,EAAMiB,oBAC3BD,cAAehB,EAAMgB,cACrBE,wBAAyBlB,EAAMkB,0BAG5B0B,IAILA,EAAsBE,aAEtBxB,EAAQyB,QAAQ,CAAChC,EAAQiC,KACvBJ,EAAsBK,SAASlC,EAAOY,MAAOqB,OAGjD,CACEE,WAAW,IAIf,MAAMC,EAAeA,KACfjD,GAAOiB,GACTjB,EAAIkD,KAAK,GAAGC,SAA4BlC,sBAjH1CmC,EAWM,MAAA,CAXAC,QAAOJ,GAAY,EACvBzC,GAAA,GAAA4C,EASgBE,EAAA,KAAAC,EARUnC,EAAAoC,MAAO,CAAvBC,EAAMX,SADhBrC,EASgBiD,EAAA,CAPbC,IAAKb,EACLjC,OAAQ4C,EACR,iBAAc,IAAO1D,EAAAe,eAAa,GAASgC,GAC3C,wBAAgC/C,EAAAc,OAAO4B,GAAE,IAAQ1C,EAAAgB,wBAA4BhB,EAAAc,OAAO4B,IAAE,IAAS1C,EAAAgB,qBAAmB,IAGlH,6BAA4BhB,EAAAiB","x_google_ignoreList":[0,1]}