{"version":3,"file":"use-component-status-legacy-DgEmIxxD.js","sources":["../../../../vue-runtime-help/src/hooks/use-component-status.ts"],"sourcesContent":["import { computed, inject, onScopeDispose, ref, shallowReactive, watchEffect } from 'vue-demi';\n\nimport type TMagicCore from '@tmagic/core';\nimport { type MComponent, type StyleSchema, toLine } from '@tmagic/core';\n\nexport interface StatusData {\n  style?: StyleSchema;\n  className?: string;\n  [key: string]: any;\n}\n\nexport const useComponentStatus = (props: { config: Omit<MComponent, 'id'> }) => {\n  const app = inject<TMagicCore>('app');\n\n  const status = ref('default');\n  const styleStatusMap = new Map<string, StyleSchema>();\n  const classStatusMap = new Map<string, string>();\n  const statusMap = new Map<string, Omit<StatusData, 'style' | 'className'>>();\n\n  const setStatus = (value: string) => {\n    status.value = value;\n  };\n\n  const registerStatus = (type: string, { style, className, ...data }: StatusData) => {\n    if (style) {\n      styleStatusMap.set(type, style);\n    }\n\n    if (className) {\n      classStatusMap.set(type, className);\n    }\n\n    statusMap.set(type, shallowReactive(data));\n  };\n\n  watchEffect(() => {\n    registerStatus('default', {\n      style: props.config.style,\n      className: props.config.className,\n    });\n  });\n\n  onScopeDispose(() => {\n    statusMap.clear();\n  });\n\n  return {\n    status: computed(() => status.value),\n\n    style: computed(() => {\n      const type = status.value || 'default';\n      const defaultStyle = styleStatusMap.get('default') || {};\n      const statusStyle = styleStatusMap.get(type);\n\n      let style = app?.transformStyle(defaultStyle) || {};\n\n      if (type !== 'default' && statusStyle) {\n        style = Object.keys(statusStyle).reduce((obj, key) => {\n          const value = statusStyle[key];\n          if (value === null || typeof value === 'undefined' || isNaN(value) || value === '') {\n            return {\n              ...obj,\n              [key]: statusStyle[key],\n            };\n          }\n          return { ...obj };\n        }, style);\n      }\n\n      if (props.config.displayHidden) {\n        style.display = 'none';\n      }\n\n      if (typeof props.config.condResult !== 'undefined' && props.config.displayRenderModel === 'mount') {\n        if (props.config.condResult === false) {\n          style.display = 'none';\n        }\n      }\n\n      return style;\n    }),\n\n    className: computed(() => {\n      const type = status.value || 'default';\n      const className = classStatusMap.get(type) ?? '';\n\n      const list = [];\n\n      if (props.config.type) {\n        list.push(`magic-ui-${toLine(props.config.type)}`);\n      }\n\n      if (props.config.layout) {\n        list.push(`magic-layout-${props.config.layout}`);\n      }\n\n      if (className) {\n        list.push(className);\n      }\n\n      return list.join(' ');\n    }),\n\n    setStatus,\n\n    registerStatus,\n  };\n};\n"],"names":["exports","props","app","inject","status","ref","styleStatusMap","Map","classStatusMap","statusMap","registerStatus","type","style","className","data","set","shallowReactive","watchEffect","config","onScopeDispose","clear","computed","value","defaultStyle","get","statusStyle","transformStyle","Object","keys","reduce","obj","key","isNaN","displayHidden","display","condResult","displayRenderModel","list","push","toLine","layout","join","setStatus"],"mappings":"+KAWaA,EAAA,IAAsBC,IACjC,MAAMC,EAAMC,EAAmB,OAEzBC,EAASC,EAAI,WACbC,MAAqBC,IACrBC,MAAqBD,IACrBE,MAAgBF,IAMhBG,EAAiBA,CAACC,GAAgBC,QAAOC,eAAcC,MACvDF,GACFN,EAAeS,IAAIJ,EAAMC,GAGvBC,GACFL,EAAeO,IAAIJ,EAAME,GAG3BJ,EAAUM,IAAIJ,EAAMK,EAAgBF,KActC,OAXAG,EAAY,KACVP,EAAe,UAAW,CACxBE,MAAOX,EAAMiB,OAAON,MACpBC,UAAWZ,EAAMiB,OAAOL,cAI5BM,EAAe,KACbV,EAAUW,UAGL,CACLhB,OAAQiB,EAAS,IAAMjB,EAAOkB,OAE9BV,MAAOS,EAAS,KACd,MAAMV,EAAOP,EAAOkB,OAAS,UACvBC,EAAejB,EAAekB,IAAI,YAAc,CAAA,EAChDC,EAAcnB,EAAekB,IAAIb,GAEvC,IAAIC,EAAQV,GAAKwB,eAAeH,IAAiB,CAAA,EAyBjD,MAvBa,YAATZ,GAAsBc,IACxBb,EAAQe,OAAOC,KAAKH,GAAaI,OAAO,CAACC,EAAKC,KAC5C,MAAMT,EAAQG,EAAYM,GAC1B,OAAIT,SAAkDU,MAAMV,IAAoB,KAAVA,EAC7D,IACFQ,EACHC,CAACA,GAAMN,EAAYM,IAGhB,IAAKD,IACXlB,IAGDX,EAAMiB,OAAOe,gBACfrB,EAAMsB,QAAU,aAGqB,IAA5BjC,EAAMiB,OAAOiB,YAAkE,UAApClC,EAAMiB,OAAOkB,qBACjC,IAA5BnC,EAAMiB,OAAOiB,aACfvB,EAAMsB,QAAU,QAIbtB,IAGTC,UAAWQ,EAAS,KAClB,MAAMV,EAAOP,EAAOkB,OAAS,UACvBT,EAAYL,EAAegB,IAAIb,IAAS,GAExC0B,EAAO,GAcb,OAZIpC,EAAMiB,OAAOP,MACf0B,EAAKC,KAAK,YAAYC,EAAOtC,EAAMiB,OAAOP,SAGxCV,EAAMiB,OAAOsB,QACfH,EAAKC,KAAK,gBAAgBrC,EAAMiB,OAAOsB,UAGrC3B,GACFwB,EAAKC,KAAKzB,GAGLwB,EAAKI,KAAK,OAGnBC,UApFiBpB,IACjBlB,EAAOkB,MAAQA,GAqFfZ"}