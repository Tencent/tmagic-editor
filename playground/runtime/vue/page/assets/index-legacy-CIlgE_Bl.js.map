{"version":3,"file":"index-legacy-CIlgE_Bl.js","sources":["../../../../../packages/utils/src/dom.ts","../../../../../node_modules/.pnpm/@tmagic+vue-page@1.0.0_@tmagic+core@1.7.6_typescript@5.9.3__@tmagic+vue-runtime-help@2._083679952c22ae1c45fb89ac7e7569d7/node_modules/@tmagic/vue-page/src/index.vue"],"sourcesContent":["export const asyncLoadJs = (() => {\n  // 正在加载或加载成功的存入此Map中\n  const documentMap = new Map();\n\n  return (url: string, crossOrigin?: string, document = globalThis.document) => {\n    let loaded = documentMap.get(document);\n    if (!loaded) {\n      loaded = new Map();\n      documentMap.set(document, loaded);\n    }\n\n    // 正在加载或已经加载成功的，直接返回\n    if (loaded.get(url)) return loaded.get(url);\n\n    const load = new Promise<void>((resolve, reject) => {\n      const script = document.createElement('script');\n      script.type = 'text/javascript';\n      if (crossOrigin) {\n        script.crossOrigin = crossOrigin;\n      }\n      script.src = url;\n      document.body.appendChild(script);\n      script.onload = () => {\n        resolve();\n      };\n      script.onerror = () => {\n        reject(new Error('加载失败'));\n      };\n      setTimeout(() => {\n        reject(new Error('timeout'));\n      }, 60 * 1000);\n    }).catch((err) => {\n      // 加载失败的，从map中移除，第二次加载时，可以再次执行加载\n      loaded.delete(url);\n      throw err;\n    });\n\n    loaded.set(url, load);\n    return loaded.get(url);\n  };\n})();\n\nexport const asyncLoadCss = (() => {\n  // 正在加载或加载成功的存入此Map中\n  const documentMap = new Map();\n\n  return (url: string, document = globalThis.document) => {\n    let loaded = documentMap.get(document);\n    if (!loaded) {\n      loaded = new Map();\n      documentMap.set(document, loaded);\n    }\n\n    // 正在加载或已经加载成功的，直接返回\n    if (loaded.get(url)) return loaded.get(url);\n\n    const load = new Promise<void>((resolve, reject) => {\n      const node = document.createElement('link');\n      node.rel = 'stylesheet';\n      node.href = url;\n      document.head.appendChild(node);\n      node.onload = () => {\n        resolve();\n      };\n      node.onerror = () => {\n        reject(new Error('加载失败'));\n      };\n      setTimeout(() => {\n        reject(new Error('timeout'));\n      }, 60 * 1000);\n    }).catch((err) => {\n      // 加载失败的，从map中移除，第二次加载时，可以再次执行加载\n      loaded.delete(url);\n      throw err;\n    });\n\n    loaded.set(url, load);\n    return loaded.get(url);\n  };\n})();\n\nexport const addClassName = (el: Element, doc: Document, className: string) => {\n  const oldEl = doc.querySelector(`.${className}`);\n  if (oldEl && oldEl !== el) removeClassName(oldEl, className);\n  if (!el.classList.contains(className)) el.classList.add(className);\n};\n\nexport const removeClassName = (el: Element, ...className: string[]) => {\n  el.classList.remove(...className);\n};\n\nexport const removeClassNameByClassName = (doc: Document, className: string) => {\n  const el: HTMLElement | null = doc.querySelector(`.${className}`);\n  el?.classList.remove(className);\n  return el;\n};\n\nexport const injectStyle = (doc: Document, style: string) => {\n  const styleEl = doc.createElement('style');\n  styleEl.innerHTML = style;\n  doc.head.appendChild(styleEl);\n  return styleEl;\n};\n\nexport const createDiv = ({ className, cssText }: { className: string; cssText: string }) => {\n  const el = globalThis.document.createElement('div');\n  el.className = className;\n  el.style.cssText = cssText;\n  return el;\n};\n\nexport const getDocument = () => globalThis.document;\n\nexport const calcValueByFontsize = (doc: Document | undefined, value: number) => {\n  if (!doc) return value;\n  const { fontSize } = doc.documentElement.style;\n\n  if (fontSize) {\n    const times = globalThis.parseFloat(fontSize) / 100;\n    return Number((value / times).toFixed(2));\n  }\n\n  return value;\n};\n\nconst dslDomRelateConfig = {\n  getIdFromEl: (el?: HTMLElement | SVGElement | null) => el?.dataset?.tmagicId,\n  getElById: (doc?: Document, id?: string | number) => doc?.querySelector(`[data-tmagic-id=\"${id}\"]`) as HTMLElement,\n  setIdToEl: (el: HTMLElement | SVGElement, id: string | number) => {\n    el.dataset.tmagicId = `${id}`;\n  },\n};\n\nexport const setDslDomRelateConfig = <\n  K extends keyof typeof dslDomRelateConfig,\n  T extends (typeof dslDomRelateConfig)[K],\n>(\n  name: K,\n  value: T,\n) => {\n  dslDomRelateConfig[name] = value;\n};\n\nexport const getIdFromEl = () => dslDomRelateConfig.getIdFromEl;\n\nexport const getElById = () => dslDomRelateConfig.getElById;\n\nexport const setIdToEl = () => dslDomRelateConfig.setIdToEl;\n","<template>\n  <component\n    :is=\"containerComponent\"\n    :class=\"className\"\n    :style=\"style\"\n    :data-tmagic-id=\"config.id\"\n    :config=\"{ ...config, [IS_DSL_NODE_KEY]: false }\"\n  ></component>\n</template>\n\n<script lang=\"ts\" setup>\nimport { inject, nextTick, watch } from 'vue';\n\nimport type TMagicApp from '@tmagic/core';\nimport { asyncLoadCss, asyncLoadJs, IS_DSL_NODE_KEY, type MPage } from '@tmagic/core';\nimport { useComponent, useComponentStatus, useNode } from '@tmagic/vue-runtime-help';\n\nconst createCss = (config: MPage) => {\n  if (config.cssFile) {\n    asyncLoadCss(config.cssFile);\n  }\n\n  if (Array.isArray(config.cssFiles)) {\n    config.cssFiles.map((file) => asyncLoadCss(file.url));\n  }\n\n  if (config.css) {\n    const style = window.document.createElement('style');\n    style.innerHTML = config.css;\n    window.document.head.appendChild(style);\n  }\n};\n\nconst createJs = (config: MPage) => {\n  if (Array.isArray(config.jsFiles)) {\n    config.jsFiles.map((file) => asyncLoadJs(file.url));\n  }\n};\n\ndefineOptions({\n  name: 'tmagic-page',\n});\n\nconst props = withDefaults(\n  defineProps<{\n    config: MPage;\n    model?: Record<string, any>;\n  }>(),\n  {\n    model: () => ({}),\n  },\n);\n\nconst app = inject<TMagicApp>('app');\n\nif (app?.jsEngine === 'browser') {\n  createCss(props.config);\n  createJs(props.config);\n}\n\nconst containerComponent = useComponent({ componentType: 'container', app });\n\nconst { style, className } = useComponentStatus(props);\n\nconst refresh = () => {\n  window.location.reload();\n};\n\nwatch(\n  () => props.config,\n  async (config, preConfig) => {\n    const node = useNode({ config: { ...config, [IS_DSL_NODE_KEY]: true } }, app);\n\n    if (config.id !== preConfig?.id) {\n      node?.setInstance({ config: props.config, refresh });\n      node?.emit('created');\n    }\n    await nextTick();\n\n    if (config.id !== preConfig?.id) {\n      node?.emit('mounted');\n      const preNode = useNode({ config: { ...preConfig, [IS_DSL_NODE_KEY]: true } }, app);\n      preNode?.emit('destroy');\n    }\n  },\n  {\n    immediate: true,\n  },\n);\n</script>\n"],"names":["asyncLoadJs","documentMap","Map","url","crossOrigin","document","globalThis","loaded","get","set","load","Promise","resolve","reject","script","createElement","type","src","body","appendChild","onload","onerror","Error","setTimeout","catch","err","delete","asyncLoadCss","node","rel","href","head","props","__props","app","inject","config","jsEngine","cssFile","Array","isArray","cssFiles","map","file","css","style","window","innerHTML","createCss","jsFiles","containerComponent","useComponent","componentType","className","useComponentStatus","refresh","location","reload","watch","async","preConfig","useNode","IS_DSL_NODE_KEY","id","setInstance","emit","nextTick","preNode","immediate","_openBlock","_createBlock","_resolveDynamicComponent","_unref","class"],"mappings":"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","x_google_ignoreList":[1]}