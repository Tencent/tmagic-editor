{"version":3,"file":"use-component-status-BkOadN8h.js","sources":["../../../../vue-runtime-help/src/hooks/use-component-status.ts"],"sourcesContent":["import { computed, inject, onScopeDispose, ref, shallowReactive, watchEffect } from 'vue-demi';\n\nimport type TMagicCore from '@tmagic/core';\nimport { type MComponent, type StyleSchema, toLine } from '@tmagic/core';\n\nexport interface StatusData {\n  style?: StyleSchema;\n  className?: string;\n  [key: string]: any;\n}\n\nexport const useComponentStatus = (props: { config: Omit<MComponent, 'id'> }) => {\n  const app = inject<TMagicCore>('app');\n\n  const status = ref('default');\n  const styleStatusMap = new Map<string, StyleSchema>();\n  const classStatusMap = new Map<string, string>();\n  const statusMap = new Map<string, Omit<StatusData, 'style' | 'className'>>();\n\n  const setStatus = (value: string) => {\n    status.value = value;\n  };\n\n  const registerStatus = (type: string, { style, className, ...data }: StatusData) => {\n    if (style) {\n      styleStatusMap.set(type, style);\n    }\n\n    if (className) {\n      classStatusMap.set(type, className);\n    }\n\n    statusMap.set(type, shallowReactive(data));\n  };\n\n  watchEffect(() => {\n    registerStatus('default', {\n      style: props.config.style,\n      className: props.config.className,\n    });\n  });\n\n  onScopeDispose(() => {\n    statusMap.clear();\n  });\n\n  return {\n    status: computed(() => status.value),\n\n    style: computed(() => {\n      const type = status.value || 'default';\n      const defaultStyle = styleStatusMap.get('default') || {};\n      const statusStyle = styleStatusMap.get(type);\n\n      let style = app?.transformStyle(defaultStyle) || {};\n\n      if (type !== 'default' && statusStyle) {\n        style = Object.keys(statusStyle).reduce((obj, key) => {\n          const value = statusStyle[key];\n          if (value === null || typeof value === 'undefined' || isNaN(value) || value === '') {\n            return {\n              ...obj,\n              [key]: statusStyle[key],\n            };\n          }\n          return { ...obj };\n        }, style);\n      }\n\n      if (props.config.displayHidden) {\n        style.display = 'none';\n      }\n\n      if (typeof props.config.condResult !== 'undefined' && props.config.displayRenderModel === 'mount') {\n        if (props.config.condResult === false) {\n          style.display = 'none';\n        }\n      }\n\n      return style;\n    }),\n\n    className: computed(() => {\n      const type = status.value || 'default';\n      const className = classStatusMap.get(type) ?? '';\n\n      const list = [];\n\n      if (props.config.type) {\n        list.push(`magic-ui-${toLine(props.config.type)}`);\n      }\n\n      if (props.config.layout) {\n        list.push(`magic-layout-${props.config.layout}`);\n      }\n\n      if (className) {\n        list.push(className);\n      }\n\n      return list.join(' ');\n    }),\n\n    setStatus,\n\n    registerStatus,\n  };\n};\n"],"names":["useComponentStatus","props","app","inject","status","ref","styleStatusMap","classStatusMap","statusMap","setStatus","value","registerStatus","type","style","className","data","shallowReactive","watchEffect","onScopeDispose","computed","defaultStyle","statusStyle","obj","key","_a","list","toLine"],"mappings":"kFAWO,MAAMA,EAAsBC,GAA8C,CAC/E,MAAMC,EAAMC,EAAmB,KAAK,EAE9BC,EAASC,EAAI,SAAS,EACtBC,MAAqB,IACrBC,MAAqB,IACrBC,MAAgB,IAEhBC,EAAaC,GAAkB,CACnCN,EAAO,MAAQM,CAAA,EAGXC,EAAiB,CAACC,EAAc,CAAE,MAAAC,EAAO,UAAAC,EAAW,GAAGC,KAAuB,CAC9EF,GACFP,EAAe,IAAIM,EAAMC,CAAK,EAG5BC,GACFP,EAAe,IAAIK,EAAME,CAAS,EAGpCN,EAAU,IAAII,EAAMI,EAAgBD,CAAI,CAAC,CAAA,EAG3C,OAAAE,EAAY,IAAM,CAChBN,EAAe,UAAW,CACxB,MAAOV,EAAM,OAAO,MACpB,UAAWA,EAAM,OAAO,SAAA,CACzB,CAAA,CACF,EAEDiB,EAAe,IAAM,CACnBV,EAAU,MAAA,CAAM,CACjB,EAEM,CACL,OAAQW,EAAS,IAAMf,EAAO,KAAK,EAEnC,MAAOe,EAAS,IAAM,CACpB,MAAMP,EAAOR,EAAO,OAAS,UACvBgB,EAAed,EAAe,IAAI,SAAS,GAAK,CAAA,EAChDe,EAAcf,EAAe,IAAIM,CAAI,EAE3C,IAAIC,GAAQX,GAAA,YAAAA,EAAK,eAAekB,KAAiB,CAAA,EAEjD,OAAIR,IAAS,WAAaS,IACxBR,EAAQ,OAAO,KAAKQ,CAAW,EAAE,OAAO,CAACC,EAAKC,IAAQ,CACpD,MAAMb,EAAQW,EAAYE,CAAG,EAC7B,OAAIb,IAAU,MAAQ,OAAOA,EAAU,KAAe,MAAMA,CAAK,GAAKA,IAAU,GACvE,CACL,GAAGY,EACH,CAACC,CAAG,EAAGF,EAAYE,CAAG,CAAA,EAGnB,CAAE,GAAGD,CAAA,CAAI,EACfT,CAAK,GAGNZ,EAAM,OAAO,gBACfY,EAAM,QAAU,QAGd,OAAOZ,EAAM,OAAO,WAAe,KAAeA,EAAM,OAAO,qBAAuB,SACpFA,EAAM,OAAO,aAAe,KAC9BY,EAAM,QAAU,QAIbA,CAAA,CACR,EAED,UAAWM,EAAS,IAAM,OACxB,MAAMP,EAAOR,EAAO,OAAS,UACvBU,GAAYU,EAAAjB,EAAe,IAAIK,CAAI,IAAvB,KAAAY,EAA4B,GAExCC,EAAO,CAAA,EAEb,OAAIxB,EAAM,OAAO,MACfwB,EAAK,KAAK,YAAY,OAAAC,EAAOzB,EAAM,OAAO,IAAI,EAAG,EAG/CA,EAAM,OAAO,QACfwB,EAAK,KAAK,gBAAgB,OAAAxB,EAAM,OAAO,OAAQ,EAG7Ca,GACFW,EAAK,KAAKX,CAAS,EAGdW,EAAK,KAAK,GAAG,CAAA,CACrB,EAED,UAAAhB,EAEA,eAAAE,CAAA,CAEJ"}