{"version":3,"file":"IteratorContainer-CfB_EWSd.js","sources":["../../../../../node_modules/.pnpm/@tmagic+vue-iterator-container@0.2.2_@tmagic+core@1.6.0_typescript@5.9.2__@tmagic+vue-r_55bb8bd30aceb1cc9729fa86d752a135/node_modules/@tmagic/vue-iterator-container/src/IteratorItem.vue","../../../../../node_modules/.pnpm/@tmagic+vue-iterator-container@0.2.2_@tmagic+core@1.6.0_typescript@5.9.2__@tmagic+vue-r_55bb8bd30aceb1cc9729fa86d752a135/node_modules/@tmagic/vue-iterator-container/src/IteratorContainer.vue"],"sourcesContent":["<template>\n  <component\n    :is=\"containerComponent\"\n    :style=\"style\"\n    :class=\"className\"\n    :config=\"config\"\n    :iterator-index=\"iteratorIndex\"\n    :iterator-container-id=\"iteratorContainerId\"\n    :page-fragment-container-id=\"pageFragmentContainerId\"\n  ></component>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, inject, type PropType } from 'vue-demi';\n\nimport type TMagicApp from '@tmagic/core';\nimport { type Id } from '@tmagic/core';\nimport { useComponent, useComponentStatus } from '@tmagic/vue-runtime-help';\n\nimport { IteratorItemSchema } from './type';\n\nexport default defineComponent({\n  name: 'tmagic-iterator-container-item',\n\n  props: {\n    config: {\n      type: Object as PropType<IteratorItemSchema>,\n      required: true,\n    },\n    iteratorIndex: Array as PropType<number[]>,\n    iteratorContainerId: Array as PropType<Id[]>,\n    containerIndex: Number,\n    pageFragmentContainerId: [String, Number] as PropType<Id>,\n    index: Number,\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n\n  setup(props) {\n    const app = inject<TMagicApp>('app');\n\n    const containerComponent = useComponent({ componentType: 'container', app });\n\n    const { style, className } = useComponentStatus(props);\n\n    return {\n      style,\n      className,\n      containerComponent,\n    };\n  },\n});\n</script>\n","<template>\n  <div @click=\"clickHandler\">\n    <IteratorItem\n      v-for=\"(item, index) in configs\"\n      :key=\"index\"\n      :config=\"item\"\n      :iterator-index=\"[...(iteratorIndex || []), index]\"\n      :iterator-container-id=\"\n        config.id ? [...(iteratorContainerId || []), config.id] : [...(iteratorContainerId || [])]\n      \"\n      :page-fragment-container-id=\"pageFragmentContainerId\"\n    ></IteratorItem>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, type PropType, watch } from 'vue-demi';\n\nimport {\n  COMMON_EVENT_PREFIX,\n  DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX,\n  type Id,\n  type IteratorContainer as TMagicIteratorContainer,\n  type MIteratorContainer,\n  type MNode,\n} from '@tmagic/core';\nimport { registerNodeHooks, useApp } from '@tmagic/vue-runtime-help';\n\nimport IteratorItem from './IteratorItem.vue';\n\ninterface IteratorContainerSchema extends Omit<MIteratorContainer, 'id'> {\n  id?: Id;\n  type?: 'iterator-container';\n}\n\ninterface IteratorItemSchema {\n  items: MNode[];\n  condResult: boolean;\n  style: {\n    [key: string]: any;\n  };\n}\n\nexport default defineComponent({\n  name: 'tmagic-iterator-container',\n\n  components: { IteratorItem },\n\n  props: {\n    config: {\n      type: Object as PropType<IteratorContainerSchema>,\n      required: true,\n    },\n    iteratorIndex: Array as PropType<number[]>,\n    iteratorContainerId: Array as PropType<Id[]>,\n    containerIndex: Number,\n    pageFragmentContainerId: [String, Number] as PropType<Id>,\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n\n  setup(props) {\n    const { app, node } = useApp(props);\n    registerNodeHooks(node);\n\n    const configs = computed<IteratorItemSchema[]>(() => {\n      let { iteratorData = [] } = props.config;\n      const { itemConfig, dsField, items } = props.config;\n\n      if (\n        !Array.isArray(iteratorData) ||\n        (typeof iteratorData[0] === 'string' && iteratorData[0].startsWith(DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX))\n      ) {\n        iteratorData = [];\n      }\n\n      if (app?.platform === 'editor' && !iteratorData.length) {\n        iteratorData.push({});\n      }\n\n      return iteratorData.map((itemData: any) => {\n        const condResult =\n          app?.platform !== 'editor'\n            ? (app?.dataSourceManager?.compliedIteratorItemConds(itemData, itemConfig, dsField) ?? true)\n            : true;\n\n        const newItems = app?.dataSourceManager?.compliedIteratorItems(itemData, items, dsField) ?? items;\n\n        return {\n          items: newItems,\n          condResult,\n          style: {\n            position: 'relative',\n            left: 0,\n            top: 0,\n            ...itemConfig.style,\n          },\n        };\n      });\n    });\n\n    watch(\n      configs,\n      (configs) => {\n        if (!props.config.id) {\n          return;\n        }\n\n        const iteratorContainerNode = app?.getNode<TMagicIteratorContainer>(props.config.id, {\n          iteratorContainerId: props.iteratorContainerId,\n          iteratorIndex: props.iteratorIndex,\n          pageFragmentContainerId: props.pageFragmentContainerId,\n        });\n\n        if (!iteratorContainerNode) {\n          return;\n        }\n\n        iteratorContainerNode.resetNodes();\n\n        configs.forEach((config, index) => {\n          iteratorContainerNode.setNodes(config.items, index);\n        });\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    const clickHandler = () => {\n      if (app && node) {\n        app.emit(`${COMMON_EVENT_PREFIX}click`, node);\n      }\n    };\n\n    return {\n      configs,\n      clickHandler,\n    };\n  },\n});\n</script>\n"],"names":["_sfc_main$1","defineComponent","props","app","inject","containerComponent","useComponent","style","className","useComponentStatus","_openBlock","_createBlock","_resolveDynamicComponent","_ctx","_normalizeStyle","_normalizeClass","_sfc_main","IteratorItem","node","useApp","registerNodeHooks","configs","computed","iteratorData","itemConfig","dsField","items","DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX","itemData","condResult","_b","_a","_d","_c","watch","iteratorContainerNode","config","index","COMMON_EVENT_PREFIX","_createElementBlock","_cache","args","_Fragment","_renderList","item","_component_IteratorItem"],"mappings":"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","x_google_ignoreList":[0,1]}