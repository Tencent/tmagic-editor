{"version":3,"file":"IteratorContainer-BZYiQmth.js","sources":["../../../../../node_modules/.pnpm/@tmagic+vue-iterator-container@1.0.0_@tmagic+core@1.7.6_typescript@5.9.3__@tmagic+vue-r_19de3c0d9e5e186b11c32b741f842344/node_modules/@tmagic/vue-iterator-container/src/IteratorItem.vue","../../../../../node_modules/.pnpm/@tmagic+vue-iterator-container@1.0.0_@tmagic+core@1.7.6_typescript@5.9.3__@tmagic+vue-r_19de3c0d9e5e186b11c32b741f842344/node_modules/@tmagic/vue-iterator-container/src/IteratorContainer.vue"],"sourcesContent":["<template>\n  <component\n    :is=\"containerComponent\"\n    :style=\"style\"\n    :class=\"className\"\n    :config=\"config\"\n    :iterator-index=\"iteratorIndex\"\n    :iterator-container-id=\"iteratorContainerId\"\n    :page-fragment-container-id=\"pageFragmentContainerId\"\n  ></component>\n</template>\n\n<script lang=\"ts\" setup>\nimport { inject } from 'vue';\n\nimport type TMagicApp from '@tmagic/core';\nimport { type Id } from '@tmagic/core';\nimport { useComponent, useComponentStatus } from '@tmagic/vue-runtime-help';\n\nimport { IteratorItemSchema } from './type';\n\ninterface IteratorItemProps {\n  config: IteratorItemSchema;\n  iteratorIndex?: number[];\n  iteratorContainerId?: Id[];\n  containerIndex?: number;\n  pageFragmentContainerId?: Id;\n  index?: number;\n  model?: Record<string, any>;\n}\n\ndefineOptions({\n  name: 'tmagic-iterator-container-item',\n});\n\nconst props = defineProps<IteratorItemProps>();\n\nconst app = inject<TMagicApp>('app');\n\nconst containerComponent = useComponent({ componentType: 'container', app });\n\nconst { style, className } = useComponentStatus(props);\n</script>\n","<template>\n  <div @click=\"clickHandler\">\n    <IteratorItem\n      v-for=\"(item, index) in configs\"\n      :key=\"index\"\n      :config=\"item\"\n      :iterator-index=\"[...(iteratorIndex || []), index]\"\n      :iterator-container-id=\"\n        config.id ? [...(iteratorContainerId || []), config.id] : [...(iteratorContainerId || [])]\n      \"\n      :page-fragment-container-id=\"pageFragmentContainerId\"\n    ></IteratorItem>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, watch } from 'vue';\n\nimport {\n  COMMON_EVENT_PREFIX,\n  type Id,\n  type IteratorContainer as TMagicIteratorContainer,\n  type MIteratorContainer,\n  type MNode,\n} from '@tmagic/core';\nimport { type ComponentProps, registerNodeHooks, useApp } from '@tmagic/vue-runtime-help';\n\nimport IteratorItem from './IteratorItem.vue';\n\ninterface IteratorContainerSchema extends Omit<MIteratorContainer, 'id'> {\n  id?: Id;\n  type?: 'iterator-container';\n}\n\ninterface IteratorItemSchema {\n  items: MNode[];\n  condResult: boolean;\n  style: {\n    [key: string]: any;\n  };\n}\n\ndefineOptions({\n  name: 'tmagic-iterator-container',\n});\n\nconst props = defineProps<ComponentProps<IteratorContainerSchema>>();\n\nconst { app, node } = useApp(props);\nregisterNodeHooks(node);\n\nconst configs = computed<IteratorItemSchema[]>(() => {\n  let { iteratorData = [] } = props.config;\n  const { itemConfig, dsField, items } = props.config;\n\n  if (!Array.isArray(iteratorData)) {\n    iteratorData = [];\n  }\n\n  if (app?.platform === 'editor' && !iteratorData.length) {\n    iteratorData.push({});\n  }\n\n  return iteratorData.map((itemData: any) => {\n    const condResult =\n      app?.platform !== 'editor'\n        ? (app?.dataSourceManager?.compliedIteratorItemConds(itemData, itemConfig, dsField) ?? true)\n        : true;\n\n    const newItems = app?.dataSourceManager?.compliedIteratorItems(itemData, items, dsField) ?? items;\n\n    return {\n      items: newItems,\n      condResult,\n      style: {\n        position: 'relative',\n        left: 0,\n        top: 0,\n        ...itemConfig.style,\n      },\n    };\n  });\n});\n\nwatch(\n  configs,\n  (configs) => {\n    if (!props.config.id) {\n      return;\n    }\n\n    const iteratorContainerNode = app?.getNode<TMagicIteratorContainer>(props.config.id, {\n      iteratorContainerId: props.iteratorContainerId,\n      iteratorIndex: props.iteratorIndex,\n      pageFragmentContainerId: props.pageFragmentContainerId,\n    });\n\n    if (!iteratorContainerNode) {\n      return;\n    }\n\n    iteratorContainerNode.resetNodes();\n\n    configs.forEach((config, index) => {\n      iteratorContainerNode.setNodes(config.items, index);\n    });\n  },\n  {\n    immediate: true,\n  },\n);\n\nconst clickHandler = () => {\n  if (app && node) {\n    app.emit(`${COMMON_EVENT_PREFIX}click`, node);\n  }\n};\n</script>\n"],"names":["props","__props","app","inject","containerComponent","useComponent","style","className","useComponentStatus","_openBlock","_createBlock","_resolveDynamicComponent","_unref","node","useApp","registerNodeHooks","configs","computed","iteratorData","itemConfig","dsField","items","itemData","condResult","_b","_a","_d","_c","watch","iteratorContainerNode","config","index","clickHandler","COMMON_EVENT_PREFIX","_createElementBlock","_Fragment","_renderList","item","IteratorItem"],"mappings":"2bAmCA,MAAMA,EAAQC,EAERC,EAAMC,EAAkB,KAAK,EAE7BC,EAAqBC,EAAa,CAAE,cAAe,YAAa,IAAAH,EAAK,EAErE,CAAE,MAAAI,EAAO,UAAAC,GAAcC,EAAmBR,CAAK,gBAxCnDS,IAAAC,EAQaC,EAPNC,EAAAR,CAAA,CAAkB,EAAA,CACtB,QAAOQ,EAAAN,CAAA,CAAK,EACZ,QAAOM,EAAAL,CAAA,CAAS,EAChB,OAAQN,EAAA,OACR,iBAAgBA,EAAA,cAChB,wBAAuBA,EAAA,oBACvB,6BAA4BA,EAAA,uBAAA,iUCsCjC,MAAMD,EAAQC,EAER,CAAE,IAAAC,EAAK,KAAAW,GAASC,EAAOd,CAAK,EAClCe,EAAkBF,CAAI,EAEtB,MAAMG,EAAUC,EAA+B,IAAM,CACnD,GAAI,CAAE,aAAAC,EAAe,EAAC,EAAMlB,EAAM,OAClC,KAAM,CAAE,WAAAmB,EAAY,QAAAC,EAAS,MAAAC,CAAA,EAAUrB,EAAM,OAE7C,OAAK,MAAM,QAAQkB,CAAY,IAC7BA,EAAe,CAAA,IAGbhB,GAAA,YAAAA,EAAK,YAAa,UAAY,CAACgB,EAAa,QAC9CA,EAAa,KAAK,EAAE,EAGfA,EAAa,IAAKI,GAAkB,aACzC,MAAMC,GACJrB,GAAA,YAAAA,EAAK,YAAa,WACbsB,GAAAC,EAAAvB,GAAA,YAAAA,EAAK,oBAAL,YAAAuB,EAAwB,0BAA0BH,EAAUH,EAAYC,KAAxE,KAAAI,EACD,GAIN,MAAO,CACL,OAHeE,GAAAC,EAAAzB,GAAA,YAAAA,EAAK,oBAAL,YAAAyB,EAAwB,sBAAsBL,EAAUD,EAAOD,KAA/D,KAAAM,EAA2EL,EAI1F,WAAAE,EACA,MAAO,CACL,SAAU,WACV,KAAM,EACN,IAAK,EACL,GAAGJ,EAAW,KAAA,CAChB,CACF,CACD,CAAA,CACF,EAEDS,EACEZ,EACCA,GAAY,CACX,GAAI,CAAChB,EAAM,OAAO,GAChB,OAGF,MAAM6B,EAAwB3B,GAAA,YAAAA,EAAK,QAAiCF,EAAM,OAAO,GAAI,CACnF,oBAAqBA,EAAM,oBAC3B,cAAeA,EAAM,cACrB,wBAAyBA,EAAM,uBAAA,GAG5B6B,IAILA,EAAsB,WAAA,EAEtBb,EAAQ,QAAQ,CAACc,EAAQC,IAAU,CACjCF,EAAsB,SAASC,EAAO,MAAOC,CAAK,CAAA,CACnD,EAAA,EAEH,CACE,UAAW,EAAA,CACb,EAGF,MAAMC,EAAe,IAAM,CACrB9B,GAAOW,GACTX,EAAI,KAAK,GAAG,OAAA+B,EAAmB,SAASpB,CAAI,CAC9C,oBAlHAqB,EAWM,MAAA,CAXA,QAAOF,GAAY,EACvBvB,EAAA,EAAA,EAAAyB,EASgBC,EAAA,KAAAC,EARUpB,EAAA,MAAO,CAAvBqB,EAAMN,SADhBrB,EASgB4B,EAAA,CAPb,IAAKP,EACL,OAAQM,EACR,iBAAc,CAAA,GAAOpC,EAAA,eAAa,CAAA,EAAS8B,CAAK,EAChD,wBAAgC9B,EAAA,OAAO,GAAE,CAAA,GAAQA,EAAA,wBAA4BA,EAAA,OAAO,EAAE,EAAA,CAAA,GAASA,EAAA,qBAAmB,EAAA,EAGlH,6BAA4BA,EAAA,uBAAA","x_google_ignoreList":[0,1]}